
; PICBASIC PRO(TM) Compiler 2.60, (c) 1998, 2009 microEngineering Labs, Inc. All Rights Reserved. 
_USED			EQU	1

	INCLUDE	"C:\PBP\16F628A.INC"


; Define statements.
#define		LCD_DREG		 PORTA
#define		LCD_DBIT		 0
#define		LCD_RSREG		 PORTA
#define		LCD_RSBIT		 4
#define		LCD_EREG		 PORTB
#define		LCD_EBIT		 7

RAM_START       		EQU	00020h
RAM_END         		EQU	0014Fh
RAM_BANKS       		EQU	00003h
BANK0_START     		EQU	00020h
BANK0_END       		EQU	0007Fh
BANK1_START     		EQU	000A0h
BANK1_END       		EQU	000EFh
BANK2_START     		EQU	00120h
BANK2_END       		EQU	0014Fh
EEPROM_START    		EQU	02100h
EEPROM_END      		EQU	0217Fh

R0              		EQU	RAM_START + 000h
R1              		EQU	RAM_START + 002h
R2              		EQU	RAM_START + 004h
R3              		EQU	RAM_START + 006h
R4              		EQU	RAM_START + 008h
R5              		EQU	RAM_START + 00Ah
R6              		EQU	RAM_START + 00Ch
R7              		EQU	RAM_START + 00Eh
R8              		EQU	RAM_START + 010h
FLAGS           		EQU	RAM_START + 012h
GOP             		EQU	RAM_START + 013h
RM1             		EQU	RAM_START + 014h
RM2             		EQU	RAM_START + 015h
RR1             		EQU	RAM_START + 016h
RR2             		EQU	RAM_START + 017h
T1              		EQU	RAM_START + 018h
T2              		EQU	RAM_START + 01Ah
T3              		EQU	RAM_START + 01Ch
_digito1         		EQU	RAM_START + 01Eh
_digito2         		EQU	RAM_START + 01Fh
_digito3         		EQU	RAM_START + 020h
_digito4         		EQU	RAM_START + 021h
_NUM             		EQU	RAM_START + 022h
_x               		EQU	RAM_START + 023h
_PORTL           		EQU	 PORTB
_PORTH           		EQU	 PORTA
_TRISL           		EQU	 TRISB
_TRISH           		EQU	 TRISA
#define _A               	_PORTB??0
#define _B               	_PORTB??1
#define _C               	_PORTB??2
#define _D               	_PORTB??3
#define _UNO             	_PORTB??4
#define _DOS             	_PORTB??5
#define _TRES            	_PORTB??6
#define _CLR             	_PORTA??5
#define _rele            	_PORTA??6
#define _beep            	_PORTA??7
#define _PORTB??0        	 PORTB, 000h
#define _PORTB??1        	 PORTB, 001h
#define _PORTB??2        	 PORTB, 002h
#define _PORTB??3        	 PORTB, 003h
#define _PORTB??4        	 PORTB, 004h
#define _PORTB??5        	 PORTB, 005h
#define _PORTB??6        	 PORTB, 006h
#define _PORTA??5        	 PORTA, 005h
#define _PORTA??6        	 PORTA, 006h
#define _PORTA??7        	 PORTA, 007h

; EEPROM data.
	ORG EEPROM_START

	ORG EEPROM_START + 000h
	DE	001h
	DE	002h
	DE	003h
	DE	004h

	INCLUDE	"LCD.MAC"
	INCLUDE	"C:\PBP\PBPPIC14.LIB"

	MOVE?CB	003h, _x
	LCDOUT?C	0FEh
	LCDOUT?C	083h
	LCDOUT?C	042h
	LCDOUT?C	069h
	LCDOUT?C	065h
	LCDOUT?C	06Eh
	LCDOUT?C	076h
	LCDOUT?C	065h
	LCDOUT?C	06Eh
	LCDOUT?C	069h
	LCDOUT?C	064h
	LCDOUT?C	06Fh

	LABEL?L	_leer	
	READADDRESS?C	000h
	READ?B	_digito1
	READADDRESS?C	001h
	READ?B	_digito2
	READADDRESS?C	002h
	READ?B	_digito3
	READADDRESS?C	003h
	READ?B	_digito4
	GOTO?L	_tecla1

	LABEL?L	_sensor	
	LOW?T	_A
	CMPNE?TCL	_UNO, 000h, L00001
	MOVE?CB	001h, _NUM
	RETURN?	
	LABEL?L	L00001	
	CMPNE?TCL	_DOS, 000h, L00003
	MOVE?CB	002h, _NUM
	RETURN?	
	LABEL?L	L00003	
	CMPNE?TCL	_TRES, 000h, L00005
	MOVE?CB	003h, _NUM
	RETURN?	
	LABEL?L	L00005	
	HIGH?T	_A
	LOW?T	_B
	CMPNE?TCL	_UNO, 000h, L00007
	MOVE?CB	004h, _NUM
	RETURN?	
	LABEL?L	L00007	
	CMPNE?TCL	_DOS, 000h, L00009
	MOVE?CB	005h, _NUM
	RETURN?	
	LABEL?L	L00009	
	CMPNE?TCL	_TRES, 000h, L00011
	MOVE?CB	006h, _NUM
	RETURN?	
	LABEL?L	L00011	
	HIGH?T	_B
	LOW?T	_C
	CMPNE?TCL	_UNO, 000h, L00013
	MOVE?CB	007h, _NUM
	RETURN?	
	LABEL?L	L00013	
	CMPNE?TCL	_DOS, 000h, L00015
	MOVE?CB	008h, _NUM
	RETURN?	
	LABEL?L	L00015	
	CMPNE?TCL	_TRES, 000h, L00017
	MOVE?CB	009h, _NUM
	RETURN?	
	LABEL?L	L00017	
	HIGH?T	_C
	LOW?T	_D
	CMPNE?TCL	_DOS, 000h, L00019
	MOVE?CB	000h, _NUM
	RETURN?	
	LABEL?L	L00019	
	HIGH?T	_D
	PAUSE?C	00Ah
	GOTO?L	_sensor

	LABEL?L	_tecla1	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	LCDOUT?C	0FEh
	LCDOUT?C	001h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	
	LCDOUT?C	0FEh
	LCDOUT?C	087h
	LCDOUT?C	058h
	LCDOUT?C	03Dh
	LCDOUT?C	0FEh
	LCDOUT?C	089h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_x
	LCDOUTDEC?	
	CMPEQ?BBL	_NUM, _digito1, _tecla2
	GOTO?L	_error1

	LABEL?L	_tecla2	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	LCDOUT?C	0FEh
	LCDOUT?C	081h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	
	CMPEQ?BBL	_NUM, _digito2, _tecla3
	GOTO?L	_error2

	LABEL?L	_tecla3	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	LCDOUT?C	0FEh
	LCDOUT?C	082h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	
	CMPEQ?BBL	_NUM, _digito3, _tecla4
	GOTO?L	_error3

	LABEL?L	_tecla4	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	LCDOUT?C	0FEh
	LCDOUT?C	083h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	
	CMPEQ?BBL	_NUM, _digito4, _abrir
	GOTO?L	_error4

	LABEL?L	_pulso	
	CMPEQ?TCB	_UNO, 000h, T1
	CMPEQ?TCB	_DOS, 000h, T2
	LOR?BBW	T1, T2, T2
	CMPEQ?TCB	_TRES, 000h, T3
	LOR?WBL	T2, T3, _pulso
	SOUNDPIN?T	_beep
	SOUND?CC	075h, 00Ah
	RETURN?	

	LABEL?L	_error1	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	LCDOUT?C	0FEh
	LCDOUT?C	081h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	

	LABEL?L	_error2	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	LCDOUT?C	0FEh
	LCDOUT?C	082h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	

	LABEL?L	_error3	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	LCDOUT?C	0FEh
	LCDOUT?C	083h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	

	LABEL?L	_error4	
	SUB?BCB	_x, 001h, _x
	CMPLE?BCL	_x, 000h, L00021
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	043h
	LCDOUT?C	06Ch
	LCDOUT?C	061h
	LCDOUT?C	076h
	LCDOUT?C	065h
	LCDOUT?C	020h
	LCDOUT?C	069h
	LCDOUT?C	06Eh
	LCDOUT?C	063h
	LCDOUT?C	06Fh
	LCDOUT?C	072h
	LCDOUT?C	072h
	LCDOUT?C	065h
	LCDOUT?C	063h
	LCDOUT?C	074h
	LCDOUT?C	061h
	SOUNDPIN?T	_beep
	SOUND?CC	073h, 00Ah
	GOTO?L	_tecla1
	LABEL?L	L00021	
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	041h
	LCDOUT?C	06Ch
	LCDOUT?C	061h
	LCDOUT?C	072h
	LCDOUT?C	06Dh
	LCDOUT?C	061h
	LCDOUT?C	020h
	LCDOUT?C	061h
	LCDOUT?C	063h
	LCDOUT?C	074h
	LCDOUT?C	069h
	LCDOUT?C	076h
	LCDOUT?C	061h
	LCDOUT?C	064h
	LCDOUT?C	061h
	LCDOUT?C	0FEh
	LCDOUT?C	089h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_x
	LCDOUTDEC?	
	GOTO?L	_alarma

	LABEL?L	_alarma	
	SOUNDPIN?T	_beep
	SOUND?CC	07Bh, 005h
	SOUND?CC	07Dh, 005h
	CMPNE?TCL	_CLR, 001h, L00023
	MOVE?CB	003h, _x
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	041h
	LCDOUT?C	06Ch
	LCDOUT?C	061h
	LCDOUT?C	072h
	LCDOUT?C	06Dh
	LCDOUT?C	061h
	LCDOUT?C	020h
	LCDOUT?C	061h
	LCDOUT?C	070h
	LCDOUT?C	061h
	LCDOUT?C	067h
	LCDOUT?C	061h
	LCDOUT?C	064h
	LCDOUT?C	061h
	LCDOUT?C	020h
	LCDOUT?C	020h
	GOTO?L	_tecla1
	LABEL?L	L00023	
	GOTO?L	_alarma

	LABEL?L	_abrir	
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	043h
	LCDOUT?C	06Ch
	LCDOUT?C	061h
	LCDOUT?C	076h
	LCDOUT?C	065h
	LCDOUT?C	020h
	LCDOUT?C	061h
	LCDOUT?C	063h
	LCDOUT?C	065h
	LCDOUT?C	070h
	LCDOUT?C	074h
	LCDOUT?C	061h
	LCDOUT?C	064h
	LCDOUT?C	061h
	HIGH?T	_rele
	PAUSE?C	00Ah
	MOVE?CB	003h, _x
	SOUNDPIN?T	_beep
	SOUND?CC	074h, 00Ah
	SOUND?CC	076h, 00Ah
	SOUND?CC	078h, 032h

	LABEL?L	_cerrar	
	HIGH?T	_A
	HIGH?T	_B
	HIGH?T	_C
	LOW?T	_D
	CMPNE?TCL	_TRES, 000h, L00025
	GOSUB?L	_pulso
	GOTO?L	_programar
	LABEL?L	L00025	
	CMPNE?TCL	_UNO, 000h, L00027
	GOSUB?L	_pulso
	LOW?T	_rele
	LCDOUT?C	0FEh
	LCDOUT?C	001h
	LCDOUT?C	043h
	LCDOUT?C	061h
	LCDOUT?C	06Eh
	LCDOUT?C	064h
	LCDOUT?C	061h
	LCDOUT?C	064h
	LCDOUT?C	06Fh
	LCDOUT?C	020h
	LCDOUT?C	063h
	LCDOUT?C	065h
	LCDOUT?C	072h
	LCDOUT?C	072h
	LCDOUT?C	061h
	LCDOUT?C	064h
	LCDOUT?C	06Fh
	GOTO?L	_tecla1
	LABEL?L	L00027	
	GOTO?L	_cerrar

	LABEL?L	_programar	
	LCDOUT?C	0FEh
	LCDOUT?C	001h
	LCDOUT?C	044h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	069h
	LCDOUT?C	074h
	LCDOUT?C	065h
	LCDOUT?C	020h
	LCDOUT?C	06Eh
	LCDOUT?C	076h
	LCDOUT?C	061h
	LCDOUT?C	020h
	LCDOUT?C	063h
	LCDOUT?C	06Ch
	LCDOUT?C	061h
	LCDOUT?C	076h
	LCDOUT?C	065h
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	WRITEADDRESS?C	000h
	WRITE?B	_NUM
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	WRITEADDRESS?C	001h
	WRITE?B	_NUM
	LCDOUT?C	0FEh
	LCDOUT?C	0C1h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	WRITEADDRESS?C	002h
	WRITE?B	_NUM
	LCDOUT?C	0FEh
	LCDOUT?C	0C2h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	
	GOSUB?L	_sensor
	GOSUB?L	_pulso
	WRITEADDRESS?C	003h
	WRITE?B	_NUM
	LCDOUT?C	0FEh
	LCDOUT?C	0C3h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?B	_NUM
	LCDOUTDEC?	
	SOUNDPIN?T	_beep
	SOUND?CC	076h, 00Ah
	SOUND?CC	074h, 00Ah
	LCDOUT?C	0FEh
	LCDOUT?C	002h
	LCDOUT?C	043h
	LCDOUT?C	06Ch
	LCDOUT?C	061h
	LCDOUT?C	076h
	LCDOUT?C	065h
	LCDOUT?C	020h
	LCDOUT?C	069h
	LCDOUT?C	06Eh
	LCDOUT?C	067h
	LCDOUT?C	072h
	LCDOUT?C	065h
	LCDOUT?C	073h
	LCDOUT?C	061h
	LCDOUT?C	064h
	LCDOUT?C	061h
	LCDOUT?C	020h
	LOW?T	_rele
	GOTO?L	_leer
	END?	

	END
